<!DOCTYPE html>
<html lang="en" style="font-size: 100px;">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no,maximum-scale=1"/>
        <meta name="full-screen" content="yes">
        <meta name="x5-fullscreen" content="true">
        <title>活动</title>
        <link rel="stylesheet" href="./styles/activities.css">
        <style>
            .act-list-container{
                overflow-y: auto;
                height: 100%;
            }
            .act-my-container{
                overflow-y: auto;
                height: 100%;
            }
        </style>
        <script src="https://media-dev-ssl.kuban.io/jquery.min.js"></script>
        <script src="./js/common.js"></script>
        <script type="text/javascript">
            document.title = '活动'
            $(function () {
                var current_type = 'all'
                var activities_list = $('.activities_list')
                var activities_my = $('.activities_my')
                var allActive = $(".all_active");
                var myActive = $(".my_active");
                var actListContainer = $('.act-list-container')
                var actMyContainer = $('.act-my-container')
                var dropload
                var my_page = 0
                var all_page = 0
                var initCount = 0
                actContainerLoad(actListContainer, 'all')
                allActive.on('click',function(){
                    if (current_type == 'all') {
                        return
                    }
                    current_type = 'all'
                    changeStyle('my')
                    actContainerLoad(actListContainer, 'all')
                });
                myActive.on('click',function(){
                    if (current_type == 'my') {
                        return
                    }
                    current_type = 'my'
                    changeStyle('all')
                    actContainerLoad(actMyContainer, 'my')
                });

                function init () {
                    var count
                    if (current_type == 'all') {
                        count = activities_list.children('.activity-list').length
                    }
                    if (current_type == 'my') {
                        count = activities_my.children('.activity-list').length
                    }

                    if (count < 3) {
                        $('.dropload-refresh').text('已全部加载')
                    }

                    if (count == 0) {
                        $('.dropload-refresh').text('')
                        $('.dropload-down').hide()
                    }
                    return count
                }

                function changeStyle(type){
                    if(type == 'my') {
                        actMyContainer.hide()
                        actListContainer.show()
                        allActive.addClass('click_style')
                        myActive.removeClass('click_style')
                    }else{
                        actMyContainer.show()
                        actListContainer.hide()
                        myActive.addClass('click_style')
                        allActive.removeClass('click_style')
                    }
                    initCount = init()
                }

                // 每页展示10个
                var size = 10;

                // dropload
                initCount = init()
                function actContainerLoad(actContainer, current_type) {
                    $("div").remove(".dropload-down");
                    dropload = actContainer.dropload({
                        scrollArea : actContainer,
                        domDown : {
                            domClass   : 'dropload-down',
                            domRefresh : '<div class="dropload-refresh">↑上拉加载更多</div>',
                            domLoad    : '<div class="dropload-load"><span class="loading"></span>加载中...</div>',
                            domNoData  : '<div class="dropload-noData">已全部加载</div>'
                        },
                        loadDownFn : function(me){
                            if (initCount == 0) {
                                return
                            }
                            var classN1 = current_type == 'my' ? 'activities_my' : 'activities_list'
                            if (current_type == 'my') {
                                my_page++
                            } else {
                                all_page++
                            }

                            // 拼接HTML
                            var result = '';
                            $.ajax({
                                type: 'GET',
                                url: 'http://ons.me/tools/dropload/json.php?page='+ (current_type == 'my' ? my_page : all_page) +'&size='+size,
                                dataType: 'json',
                                success: function(data){
                                    var arrLen = data.length;
                                    if(arrLen > 0){
                                        for(var i=0; i<arrLen; i++){
                                            result += '<a href="javascript:;" class="activity-list" onclick="toActivity(8, this)" data-redirect-url="https://www.baidu.com">'
                                                    + '<div class="single">'
                                                    + '<img src="https://media-dev-ssl.kuban.io/uploads/locations/2b86d476-a814-43bb-b37b-171662ddeb98.png" alt="img" class="cover">'
                                                    + '<div class="state">'
                                                    + '<span class="status_tag p_bg">正在进行</span>'
                                                    + '</div>'
                                                    + '<div class="header">'
                                                    + '<span class="title">测试(6个字符))</span>'
                                                    + '<span class="price_1">免费</span>'
                                                    + '</div>'
                                                    + '<div class="time">'
                                                    + '<img src="https://media-ssl.kuban.io/static/h5/images/hd/time@2x.png" alt="img" class="t_icon">'
                                                    + '<span class="d_time">09月12日 — 09月30日</span>'
                                                    + '</div>'
                                                    + '<div class="location">'
                                                    + '<div>'
                                                    + '<img src="https://media-ssl.kuban.io/static/h5/images/hd/address@2x.png" alt="img">'
                                                    + '<span>三元桥店</span>'
                                                    + '</div>'
                                                    + '<div>剩余名额297</div>'
                                                    + '</div>'
                                                    + '</div>'
                                                    + '</a>'
                                        }
                                        // 如果没有数据
                                    }else{
                                        // 锁定
                                        me.lock();
                                        // 无数据
                                        me.noData();
                                    }
                                    // 为了测试，延迟1秒加载
                                    setTimeout(function(){
                                        // 插入数据到页面，放到最后面
                                        $('.' + classN1).append(result);
                                        // 每次数据插入，必须重置
                                        me.resetload();
                                    },1000);
                                },
                                error: function(xhr, type){
                                    // 即使加载出错，也得重置
                                    me.resetload();
                                }
                            });
                        },
                        threshold : 10
                    });
                }
            });
            
            function toActivity(id, ele) {
                var url = $(ele).attr('data-redirect-url')
                callClientHandler(url || ('/'+ id), {}, url ? 'redirectUrl' : 'activityGoToPage')
            }
        </script>
    </head>
    <body>
        <div class="tab_head">
            <a><span class="all_active click_style">所有活动</span></a>
            <a><span class="my_active">我的活动</span></a>
        </div>

        <div class="act-list-container">
            <div class="activities_list">
                <!--如果没有活动  显示缺省-->
                <div class="no_active">
                    <img src="https://media-ssl.kuban.io/static/wechat/images/activity/activity_none@3x.png" alt="">
                    <div>暂无活动</div>
                </div>
                <a href="javascript:;" class="activity-list" onclick="toActivity(8, this)" data-redirect-url="https://www.baidu.com">
                    <div class="single">
                        <img src="https://media-ssl.kuban.io/area/1082855/images/148986008896ba0122.jpeg?imageView2/1/w/378/h/224/interlace/1" alt="img" class="cover">
                        <div class="state">
                            <span class="status_tag p_bg">正在进行</span>
                        </div>
                        <div class="header">
                            <span class="title">测试(6个字符))</span>
                            <span class="price_1">免费</span>
                        </div>
                        <div class="time">
                            <img src="https://media-ssl.kuban.io/static/h5/images/hd/time@2x.png" alt="img" class="t_icon">
                            <span class="d_time">09月12日 — 09月30日</span>
                        </div>
                        <div class="location">
                            <div>
                                <img src="https://media-ssl.kuban.io/static/h5/images/hd/address@2x.png" alt="img">
                                <span>三元桥店</span>
                            </div>
                            <div>剩余名额297</div>
                        </div>
                    </div>
                </a>
                <a href="javascript:;" class="activity-list" onclick="toActivity(8, this)">
                    <div class="single">
                        <img src="https://media-ssl.kuban.io/area/1082855/images/148998392896eb6aa5.jpg?imageView2/1/w/378/h/224/interlace/1" alt="img" class="cover">
                        <div class="state">
                            <span class="status_tag s_bg">即将开始</span>
                        </div>
                        <div class="header">
                            <span class="title">三元桥撸串</span>

                            <span class="price_1">免费</span>

                        </div>
                        <div class="time">
                            <img src="https://media-ssl.kuban.io/static/h5/images/hd/time@2x.png" alt="img" class="t_icon">
                            <span class="d_time">09月12日 — 09月30日</span>
                        </div>
                        <div class="location">
                            <div>
                                <img src="https://media-ssl.kuban.io/static/h5/images/hd/address@2x.png" alt="img">
                                <span>三元桥店</span>
                            </div>
                            <div>剩余名额297</div>
                        </div>
                    </div>
                </a>
                <a  href="javascript:;" class="activity-list" onclick="toActivity(8, this)" data-redirect-url="https://www.baidu.com">
                    <div class="single">
                        <img src="https://media-dev-ssl.kuban.io/uploads/locations/2b86d476-a814-43bb-b37b-171662ddeb98.png" alt="img" class="cover">
                        <div class="state">
                            <span class="status_tag p_bg">正在进行</span>
                        </div>
                        <div class="header">
                            <span class="title">测试(6个字符)</span>
                            <span class="price_1">免费</span>
                        </div>
                        <div class="time">
                            <img src="https://media-ssl.kuban.io/static/h5/images/hd/time@2x.png" alt="img" class="t_icon">
                            <span class="d_time">09月12日 — 09月30日</span>
                        </div>
                        <div class="location">
                            <div>
                                <img src="https://media-ssl.kuban.io/static/h5/images/hd/address@2x.png" alt="img">
                                <span>三元桥店</span>
                            </div>
                            <div>剩余名额297</div>
                        </div>
                    </div>
                </a>
                <a href="javascript:;" class="activity-list" onclick="toActivity(8, this)">
                    <div class="single">
                        <img src="https://media-dev-ssl.kuban.io/uploads/locations/2b86d476-a814-43bb-b37b-171662ddeb98.png" alt="img" class="cover">
                        <div class="state">
                            <span class="status_tag p_bg">正在进行</span>
                        </div>
                        <div class="header">
                            <span class="title">三元桥撸串</span>

                            <span class="price_1">免费</span>

                        </div>
                        <div class="time">
                            <img src="https://media-ssl.kuban.io/static/h5/images/hd/time@2x.png" alt="img" class="t_icon">
                            <span class="d_time">09月12日 — 09月30日</span>
                        </div>
                        <div class="location">
                            <div>
                                <img src="https://media-ssl.kuban.io/static/h5/images/hd/address@2x.png" alt="img">
                                <span>三元桥店</span>
                            </div>
                            <div>剩余名额297</div>
                        </div>
                    </div>
                </a>
                <a href="javascript:;" class="activity-list" onclick="toActivity(8, this)">
                    <div class="single">
                        <img src="https://media-dev-ssl.kuban.io/uploads/locations/2b86d476-a814-43bb-b37b-171662ddeb98.png" alt="img" class="cover">
                        <div class="state">
                            <span class="status_tag p_bg">正在进行</span>
                        </div>
                        <div class="header">
                            <span class="title">三元桥撸串</span>

                            <span class="price_1">免费</span>

                        </div>
                        <div class="time">
                            <img src="https://media-ssl.kuban.io/static/h5/images/hd/time@2x.png" alt="img" class="t_icon">
                            <span class="d_time">09月12日 — 09月30日</span>
                        </div>
                        <div class="location">
                            <div>
                                <img src="https://media-ssl.kuban.io/static/h5/images/hd/address@2x.png" alt="img">
                                <span>三元桥店</span>
                            </div>
                            <div>剩余名额297</div>
                        </div>
                    </div>
                </a>
            </div>
        </div>
        <div class="act-my-container">
            <div class="activities_my">
                <a href="javascript:;" class="activity-list" onclick="toActivity(8, this)">
                    <div class="single">
                        <img src="https://media-dev-ssl.kuban.io/uploads/locations/2b86d476-a814-43bb-b37b-171662ddeb98.png" alt="img" class="cover">
                        <div class="state">
                            <span class="status_tag p_bg">正在进行</span>
                        </div>
                        <div class="header">
                            <span class="title">三元桥撸串</span>

                            <span class="price_1">免费</span>

                        </div>
                        <div class="time">
                            <img src="https://media-ssl.kuban.io/static/h5/images/hd/time@2x.png" alt="img" class="t_icon">
                            <span class="d_time">09月12日 — 09月30日</span>
                        </div>
                        <div class="location">
                            <div>
                                <img src="https://media-ssl.kuban.io/static/h5/images/hd/address@2x.png" alt="img">
                                <span>三元桥店</span>
                            </div>
                            <div>剩余名额297</div>
                        </div>
                    </div>
                </a>
                <a href="javascript:;" class="activity-list" onclick="toActivity(8, this)">
                    <div class="single">
                        <img src="https://media-dev-ssl.kuban.io/uploads/locations/2b86d476-a814-43bb-b37b-171662ddeb98.png" alt="img" class="cover">
                        <div class="state">
                            <span class="status_tag p_bg">正在进行</span>
                        </div>
                        <div class="header">
                            <span class="title">三元桥撸串</span>

                            <span class="price_1">免费</span>

                        </div>
                        <div class="time">
                            <img src="https://media-ssl.kuban.io/static/h5/images/hd/time@2x.png" alt="img" class="t_icon">
                            <span class="d_time">09月12日 — 09月30日</span>
                        </div>
                        <div class="location">
                            <div>
                                <img src="https://media-ssl.kuban.io/static/h5/images/hd/address@2x.png" alt="img">
                                <span>三元桥店</span>
                            </div>
                            <div>剩余名额297</div>
                        </div>
                    </div>
                </a>
                <a href="javascript:;" class="activity-list" onclick="toActivity(8, this)">
                    <div class="single">
                        <img src="https://media-dev-ssl.kuban.io/uploads/locations/2b86d476-a814-43bb-b37b-171662ddeb98.png" alt="img" class="cover">
                        <div class="state">
                            <span class="status_tag p_bg">正在进行</span>
                        </div>
                        <div class="header">
                            <span class="title">三元桥撸串</span>

                            <span class="price_1">免费</span>

                        </div>
                        <div class="time">
                            <img src="https://media-ssl.kuban.io/static/h5/images/hd/time@2x.png" alt="img" class="t_icon">
                            <span class="d_time">09月12日 — 09月30日</span>
                        </div>
                        <div class="location">
                            <div>
                                <img src="https://media-ssl.kuban.io/static/h5/images/hd/address@2x.png" alt="img">
                                <span>三元桥店</span>
                            </div>
                            <div>剩余名额297</div>
                        </div>
                    </div>
                </a>
                <a href="javascript:;" class="activity-list" onclick="toActivity(8, this)">
                    <div class="single">
                        <img src="https://media-dev-ssl.kuban.io/uploads/locations/2b86d476-a814-43bb-b37b-171662ddeb98.png" alt="img" class="cover">
                        <div class="state">
                            <span class="status_tag p_bg">正在进行</span>
                        </div>
                        <div class="header">
                            <span class="title">三元桥撸串</span>

                            <span class="price_1">免费</span>

                        </div>
                        <div class="time">
                            <img src="https://media-ssl.kuban.io/static/h5/images/hd/time@2x.png" alt="img" class="t_icon">
                            <span class="d_time">09月12日 — 09月30日</span>
                        </div>
                        <div class="location">
                            <div>
                                <img src="https://media-ssl.kuban.io/static/h5/images/hd/address@2x.png" alt="img">
                                <span>三元桥店</span>
                            </div>
                            <div>剩余名额297</div>
                        </div>
                    </div>
                </a>
                <a href="javascript:;" class="activity-list" onclick="toActivity(8, this)">
                    <div class="single">
                        <img src="https://media-dev-ssl.kuban.io/uploads/locations/2b86d476-a814-43bb-b37b-171662ddeb98.png" alt="img" class="cover">
                        <div class="state">
                            <span class="status_tag p_bg">正在进行</span>
                        </div>
                        <div class="header">
                            <span class="title">三元桥撸串</span>

                            <span class="price_1">免费</span>

                        </div>
                        <div class="time">
                            <img src="https://media-ssl.kuban.io/static/h5/images/hd/time@2x.png" alt="img" class="t_icon">
                            <span class="d_time">09月12日 — 09月30日</span>
                        </div>
                        <div class="location">
                            <div>
                                <img src="https://media-ssl.kuban.io/static/h5/images/hd/address@2x.png" alt="img">
                                <span>三元桥店</span>
                            </div>
                            <div>剩余名额297</div>
                        </div>
                    </div>
                </a>
            </div>
        </div>
    </body>
</html>